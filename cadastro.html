<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Amor Conect</title>
    <link rel="stylesheet" href="globals.css">
    <link rel="stylesheet" href="components.css">
    
    <style>
        .auth-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--bege);
            padding: 10px;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .form-group {
            position: relative;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="logoamorconect.png" alt="Amor Conect">
                    <h1>Amor Conect</h1>
                </div>
                <div class="auth-buttons">
                    <a href="login.html" class="btn btn-outline">Entrar</a>
                    <a href="cadastro.html" class="btn btn-primary">Cadastre-se</a>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="auth-container">
                <div class="auth-header">
                    <img src="logoamorconect.png" alt="Amor Conect" class="auth-logo">
                    <h1>Criar Conta</h1>
                    <p>Junte-se ao Amor Conect e encontre sua conex√£o perfeita</p>
                </div>

                <div id="errorAlert" class="alert alert-error" style="display: none;"></div>
                <div id="successAlert" class="alert alert-success" style="display: none;"></div>
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Processando cadastro...</p>
                </div>

                <form id="registerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">Nome *</label>
                            <input type="text" id="firstName" class="form-control" required placeholder="Seu nome">
                            <div id="firstNameError" class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Sobrenome *</label>
                            <input type="text" id="lastName" class="form-control" required placeholder="Seu sobrenome">
                            <div id="lastNameError" class="error-message"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="nickname">Apelido *</label>
                        <input type="text" id="nickname" class="form-control" required placeholder="Como quer ser chamado">
                        <div id="nicknameError" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="email">E-mail *</label>
                        <input type="email" id="email" class="form-control" required placeholder="seu@email.com">
                        <div id="emailError" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="birthDate">Data de Nascimento *</label>
                        <input type="date" id="birthDate" class="form-control" required>
                        <div id="birthDateError" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label for="password">Senha *</label>
                        <input type="password" id="password" class="form-control" required placeholder="Crie uma senha forte">
                        <button type="button" class="password-toggle" id="togglePassword">üëÅÔ∏è</button>
                        <div id="passwordError" class="error-message"></div>
                        
                        <div class="password-requirements">
                            <h4>Requisitos da senha:</h4>
                            <ul class="requirements-list">
                                <li id="reqLength">M√≠nimo 8 caracteres</li>
                                <li id="reqUppercase">Pelo menos 1 letra mai√∫scula</li>
                                <li id="reqLowercase">Pelo menos 1 letra min√∫scula</li>
                                <li id="reqNumber">Pelo menos 1 n√∫mero</li>
                                <li id="reqSpecial">Pelo menos 1 s√≠mbolo</li>
                            </ul>
                            <div class="password-strength">
                                <div id="strengthBar" class="strength-bar"></div>
                            </div>
                            <div id="strengthText" class="strength-text"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Confirmar Senha *</label>
                        <input type="password" id="confirmPassword" class="form-control" required placeholder="Digite a senha novamente">
                        <div id="confirmPasswordError" class="error-message"></div>
                    </div>

                    <div class="terms-group">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">
                            Concordo com os <a href="#">Termos de Servi√ßo</a> e 
                            <a href="#">Pol√≠tica de Privacidade</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                        Criar Conta
                    </button>

                    <div class="auth-footer">
                        <p>J√° tem uma conta? <a href="login.html">Fa√ßa login aqui</a></p>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Amor Conect</h3>
                    <p>Encontre sua conex√£o perfeita</p>
                </div>
                <div class="footer-column">
                    <h3>Links</h3>
                    <ul>
                        <li><a href="index.html">In√≠cio</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="cadastro.html">Cadastro</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 Amor Conect</p>
            </div>
        </div>
    </footer>

    <script src="globals.js"></script>
    <script src="auth.js"></script>

    <script>
        // ‚úÖ CONFIGURA√á√ÉO DO CADASTRO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Cadastro inicializado');
            
            // Data m√°xima (18 anos)
            const today = new Date();
            const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
            document.getElementById('birthDate').max = maxDate.toISOString().split('T')[0];

            // Toggle senha
            document.getElementById('togglePassword').addEventListener('click', function() {
                const password = document.getElementById('password');
                const type = password.type === 'password' ? 'text' : 'password';
                password.type = type;
                this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üîí';
            });

            // For√ßa da senha
            document.getElementById('password').addEventListener('input', function(e) {
                updatePasswordStrength(e.target.value);
            });

            // Submit form
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        });

        function updatePasswordStrength(password) {
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };

            // Atualizar lista
            Object.keys(requirements).forEach(key => {
                const element = document.getElementById('req' + key.charAt(0).toUpperCase() + key.slice(1));
                if (element) {
                    element.className = requirements[key] ? 'requirement-met' : 'requirement-unmet';
                }
            });

            // Atualizar barra
            const strength = Object.values(requirements).filter(Boolean).length;
            const bar = document.getElementById('strengthBar');
            const text = document.getElementById('strengthText');
            
            bar.className = 'strength-bar';
            if (strength <= 2) {
                bar.classList.add('strength-weak');
                text.textContent = 'Fraca';
                text.style.color = '#ef4444';
            } else if (strength <= 3) {
                bar.classList.add('strength-fair');
                text.textContent = 'Razo√°vel';
                text.style.color = '#f59e0b';
            } else if (strength <= 4) {
                bar.classList.add('strength-good');
                text.textContent = 'Boa';
                text.style.color = '#eab308';
            } else {
                bar.classList.add('strength-strong');
                text.textContent = 'Forte';
                text.style.color = '#22c55e';
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            console.log('üìù Iniciando cadastro...');

            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const errorAlert = document.getElementById('errorAlert');
            const successAlert = document.getElementById('successAlert');

            // Mostrar loading
            submitBtn.disabled = true;
            loading.style.display = 'block';
            errorAlert.style.display = 'none';
            successAlert.style.display = 'none';

            // Coletar dados
            const formData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                nickname: document.getElementById('nickname').value.trim(),
                email: document.getElementById('email').value.trim(),
                birthDate: document.getElementById('birthDate').value,
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                terms: document.getElementById('terms').checked
            };

            try {
                // ‚úÖ CADASTRO NO SUPABASE
                const { data, error } = await supabase.auth.signUp({
                    email: formData.email,
                    password: formData.password,
                    options: {
                        data: {
                            full_name: `${formData.firstName} ${formData.lastName}`,
                            nickname: formData.nickname,
                            birth_date: formData.birthDate
                        },
                        emailRedirectTo: `${window.location.origin}/verificacao-email.html`
                    }
                });

                if (error) throw error;

                console.log('‚úÖ Cadastro realizado:', data);

                if (data.user) {
                    successAlert.innerHTML = `
                        ‚úÖ <strong>Cadastro realizado com sucesso!</strong><br>
                        üìß Enviamos um e-mail de confirma√ß√£o para:<br>
                        <strong>${formData.email}</strong><br><br>
                        üí° <em>Verifique sua caixa de entrada e pasta de spam</em>
                    `;
                    successAlert.style.display = 'block';
                    
                    // Redirecionar para verifica√ß√£o
                    setTimeout(() => {
                        window.location.href = `verificacao-email.html?email=${encodeURIComponent(formData.email)}`;
                    }, 4000);
                }

            } catch (error) {
                console.error('‚ùå Erro no cadastro:', error);
                errorAlert.textContent = `‚ùå Erro: ${error.message}`;
                errorAlert.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>